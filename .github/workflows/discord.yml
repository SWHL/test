name: discord message
on:
  release:
    types: [published]  # åªåœ¨æ­£å¼å‘å¸ƒ release æ—¶è§¦å‘ï¼ˆä¸åŒ…æ‹¬è‰ç¨¿ï¼‰
jobs:
 notify-discord:
    runs-on: ubuntu-latest
    steps:
      - name: Get release info
        run: |
          echo "RELEASE_TITLE=${{ github.event.release.name || github.event.release.tag_name }}" >> $GITHUB_ENV
          echo "RELEASE_URL=${{ github.event.release.html_url }}" >> $GITHUB_ENV
          echo "RELEASE_BODY<<EOF_RELEASE_BODY" >> $GITHUB_ENV
          echo "${{ github.event.release.body }}" >> $GITHUB_ENV
          echo "EOF_RELEASE_BODY" >> $GITHUB_ENV

      - name: Send message to Discord
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          curl -X POST -H "Content-Type: application/json" \
            -d "{
              \"username\": \"GitHub Releases\",
              \"avatar_url\": \"https://github.githubassets.com/images/modules/logos_page/GitHub-Mark.png\",
              \"embeds\": [{
                \"title\": \"ðŸš€ New Release: ${{ env.RELEASE_TITLE }}\",
                \"url\": \"${{ env.RELEASE_URL }}\",
                \"description\": \"${{ env.RELEASE_BODY }}\",
                \"color\": 3066993,
                \"timestamp\": \"$(date -u +"%Y-%m-%dT%H:%M:%SZ")\"
              }]
            }" \
            "$DISCORD_WEBHOOK_URL"

