# name: Auto Tweet

# on:
#   # ÂèØ‰ª•Ê†πÊçÆÈúÄË¶ÅËß¶ÂèëÔºå‰æãÂ¶Ç push Âà∞ main„ÄÅrelease„ÄÅschedule Á≠â
#   push:
#     branches:
#       - main

# jobs:
#   setup:
#     runs-on: ubuntu-latest
#     steps:
#       - uses: nearform-actions/github-action-notify-twitter@v1.2.3
#         with:
#           message: |
#             ${{ github.event.repository.name }} ${{ github.event.release.tag_name }} has been released. Check out the release notes: ${{ github.event.release.html_url }}
#           twitter-app-key: ${{ secrets.TWITTER_APP_KEY }}
#           twitter-app-secret: ${{ secrets.TWITTER_APP_SECRET }}
#           twitter-access-token: ${{ secrets.TWITTER_ACCESS_TOKEN }}
#           twitter-access-token-secret: ${{ secrets.TWITTER_ACCESS_TOKEN_SECRET }}


# jobs:
#   build:
#     runs-on: ubuntu-latest
#     steps:
#       - name: Post Twitter Status
#         uses: julb/action-post-twitter-status@v1
#         with:
#           message: "Hello from Github Action!"
#           twitter_app_consumer_api_key: ${{ secrets.TWITTER_APP_KEY }}
#           twitter_app_consumer_api_secret_key: ${{ secrets.TWITTER_APP_SECRET }}
#           twitter_app_access_token: ${{ secrets.TWITTER_ACCESS_TOKEN }}
#           twitter_app_access_token_secret: ${{ secrets.TWITTER_ACCESS_TOKEN_SECRET }}


name: Tweet on Release

on:
  # release:
  #   types: [published]
  push:
    branches:
      - main

jobs:
  tweet:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install tweepy
        run: pip install tweepy

      - name: Send Tweet
        env:
          TWITTER_CONSUMER_KEY: ${{ secrets.TWITTER_APP_KEY }}
          TWITTER_CONSUMER_SECRET: ${{ secrets.TWITTER_APP_SECRET }}
          TWITTER_ACCESS_TOKEN: ${{ secrets.TWITTER_ACCESS_TOKEN }}
          TWITTER_ACCESS_TOKEN_SECRET: ${{ secrets.TWITTER_ACCESS_TOKEN_SECRET }}
          MESSAGE: "${{ github.event.repository.name }} ${{ github.event.release.tag_name }} is out! üéâ"
        run: |
          python -c "
          import tweepy
          import os

          client = tweepy.Client(
              consumer_key=os.environ['TWITTER_CONSUMER_KEY'],
              consumer_secret=os.environ['TWITTER_CONSUMER_SECRET'],
              access_token=os.environ['TWITTER_ACCESS_TOKEN'],
              access_token_secret=os.environ['TWITTER_ACCESS_TOKEN_SECRET']
          )

          try:
              response = client.create_tweet(text=os.environ['MESSAGE'][:280])
              print('‚úÖ Tweet sent! ID:', response.data['id'])
          except Exception as e:
              print('‚ùå Error:', e)
              exit(1)
          "